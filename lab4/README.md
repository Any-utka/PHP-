# Обработка и валидация форм

>> Доцен Анна, группа IA2303

## Цель работы

Освоить основные принципы работы с HTML-формами в PHP, включая отправку данных на сервер и их обработку, включая валидацию данных.
Данная работа станет основой для дальнейшего изучения разработки веб-приложений. Дальнейшие лабораторные работы будут основываться на данной.

### Задание

1. Создать структуру проекта
2. Создать форму для добавления книг
3. Обработать формы
4. Отобразить книги

### Описание выполнения работы

1. Создаем структу проекта:

```plaintext

├───public
│   │   index.php
│   │   styles.css
│   │
│   └───book
│           create.php
│           index.php
│
├───src
│   │   helpers.php
│   │
│   └───Handlers
│           CreateBookHandler.php
│
└───storage
    books.json
```

2. Создаем форму для добавления книги

```html
<h2>Добавить новую книгу</h2>

    <form method="POST" action="">

        <label for="title">Название книги:</label>
        <input type="text" id="title" name="title" required><br><br>

        <label for="author">Автор книги:</label>
        <input type="text" id="author" name="author" required><br><br>

        <label for="tags">Жанр:</label>
        <select name="tags" id="tags" required>
            <option value="">Выберите жанр</option>
            <option value="классика">Классика</option>
            <option value="фантастика">Фантастика</option>
            <option value="детектив">Детектив</option>
            <option value="научпоп">Научпоп</option>
            <option value="история">История</option>
            <option value="роман">Роман</option>
        </select><br><br>

        <label for="description">Описание книги:</label><br>
        <textarea id="description" name="description" required></textarea><br><br>

        <button type="submit">Добавить книгу</button>
    </form>
```

3. Создаем функцию для валидации данных

```php
    function validateForm($title, $author, $genre, $description)
{
    $errors = [];

    if (empty($title)) {
        $errors[] = 'Название книги не может быть пустым.';
    }

    if (empty($author)) {
        $errors[] = 'Автор не может быть пустым.';
    }

    if (empty($genre)) {
        $errors[] = 'Жанр книги не может быть пустым.';
    }

    if (empty($description)) {
        $errors[] = 'Описание книги не может быть пустым.';
    }

    return $errors;
}
```

4. Создаем функцию для сохранения данных в файл

```php
function saveDataToFile($filePath, $bookData)
{
    $data = json_encode($bookData, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
    return file_put_contents($filePath, $data . PHP_EOL, FILE_APPEND);
}
```

5. Отображаем последние две книги

```php
$showLastTwo = isset($_GET['last']) && $_GET['last'] === '1';
if ($showLastTwo) {
    $filteredBooks = array_slice($filteredBooks, -2);
}
```

#### Ответы на контрольные вопросы

1. Методы HTTP для отправки данных формы:
   - **GET:** Этот метод используется для отправки данных через URL. Все данные формы передаются в строке запроса (после знака ?). Это подходящий метод для поиска или фильтрации данных, так как данные остаются видимыми в адресной строке. Он ограничен длиной данных, и не рекомендуется использовать его для отправки конфиденциальной информации.
   - **POST:** Этот метод отправляет данные в теле HTTP-запроса, что делает его более безопасным для передачи конфиденциальной информации (например, паролей). Также не ограничен длиной данных, в отличие от GET.
   - **PUT** и **DELETE:** Эти методы реже используются для отправки данных, но они применяются, например, в API для обновления (PUT) или удаления (DELETE) данных на сервере. Для обычных веб-форм они не используются.
  
2. Валидация и фильтрация

**Валидация данных** — это процесс проверки данных на соответствие заранее установленным правилам. Цель валидации — убедиться, что данные корректны и подходят для использования. Например, проверка того, что введённый адрес электронной почты имеет правильный формат, или что поле с возрастом содержит число в определённом диапазоне.

*Примеры валидации:*

- Проверка, что поле не пустое.
- Проверка правильности формата данных (например, email).
- Проверка диапазона числовых значений (например, возраст должен быть больше 18).
- Валидация не изменяет данные, а лишь проверяет их соответствие требованиям.

**Фильтрация данных** — это процесс очистки данных от ненужных или опасных элементов, таких как специальные символы, лишние пробелы или теги HTML. Цель фильтрации — подготовить данные для безопасного использования, например, для отображения на веб-странице или сохранения в базе данных.

*Примеры фильтрации:*

- Удаление лишних пробелов.
- Преобразование строки в нижний регистр.
- Удаление или экранирование HTML-тегов, чтобы избежать XSS-уязвимостей.
- Фильтрация помогает сделать данные безопасными, но не проверяет их корректность, как это делает валидация.

3. Функции PHP для фильтрации данных

- ```filter_var()``` — одна из самых универсальных функций для фильтрации данных. Она может использоваться для различных целей: от удаления лишних символов до проверки формата данных.
- ```filter_input()``` — фильтрует данные, полученные через глобальные массивы, такие как ```$_GET, $_POST, $_COOKIE.```
- ```trim()``` — удаляет пробелы (или другие символы) из начала и конца строки.
- ```htmlspecialchars()``` — преобразует специальные символы в HTML-сущности, что помогает защититься от XSS (межсайтовых скриптов).
- ```strip_tags()``` — удаляет HTML и PHP теги из строки.
